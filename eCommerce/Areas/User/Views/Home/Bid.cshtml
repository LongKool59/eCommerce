@model eCommerce.Areas.User.Models.ViewModel
@using eCommerce.Models;
@{
    ViewBag.Title = "Đấu giá";
    Layout = "~/Areas/User/Views/Shared/_LayoutUser.cshtml";}


<style>
    h1.function-page-title {
        font-size: 2.2rem;
        font-weight: 400;
        color: black;
        text-align: center;
        padding: 1.5rem 0;
        background: #84CEEB;
        font-weight: bold;
    }

    p {
        padding: 2px;
        font-weight: bold;
        font-size: 14px;
    }

    .table1 {
        font-family: arial, sans-serif;
        border-collapse: collapse;
        width: 100%;
    }

    td, th {
        border: 1px solid #dddddd;
        text-align: left;
        padding: 8px;
    }

    tr:nth-child(even) {
        background-color: #dddddd;
    }
    #cuon {
        border: 1px solid #dddddd;
        height: 180px;
        width:300px;
        padding: 20px;
        overflow: scroll;
    }
</style>
<h1 class="function-page-title">ĐẤU GIÁ SẢN PHẨM</h1>

<div>
    <div class="row">
        <div class="col-md-6">
            <div>
                @if (Model.YeuThich)
                {
                    using (Html.BeginForm("UnFavorite", "Home", FormMethod.Post))
                    {
                        <input value="0" hidden="true" name="loai" />

                        <button type="submit" name="id" value="@Model.DauGia.MaDauGia" class="btn btn-delete_employeemr-2" style="        background-color: orangered"> Bỏ Yêu thích</button>

                    }
                }
                else
                {
                    using (Html.BeginForm("Favorite", "Home", FormMethod.Post))
                    {
                        <input value="0" hidden="true" name="loai" />

                        <button type="submit" name="id" value="@Model.DauGia.MaDauGia" class="btn btn-delete_employeemr-2" style="background-color:greenyellow"> Yêu thích</button>

                    }
                }
            </div>
            <p>Hình ảnh sản phẩm:</p>
            <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
                <ol class="carousel-indicators">
                    <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
                    <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
                    <li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
                    <li data-target="#carouselExampleIndicators" data-slide-to="3"></li>
                </ol>
                <div class="carousel-inner">
                    <div class="carousel-item active">
                        <img class="d-block w-100" src="@Url.Content(Model.Hinh[0])" alt="First slide" style="width:400px; height:600px">
                    </div>
                    <div class="carousel-item">
                        <img class="d-block w-100" src="@Url.Content(Model.Hinh[1])" alt="Second slide" style="width:400px; height:600px">
                    </div>
                    <div class="carousel-item">
                        <img class="d-block w-100" src="@Url.Content(Model.Hinh[2])" alt="Third slide" style="width:400px; height:600px">
                    </div>
                    <div class="carousel-item">
                        <img class="d-block w-100" src="@Url.Content(Model.Hinh[3])" alt="Fourth slide" style="width:400px; height:600px">
                    </div>
                </div>
                <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="sr-only">Previous</span>
                </a>
                <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="sr-only">Next</span>
                </a>
            </div>
        </div>
        <div class="col-md-6">
            <p>Thông tin sản phẩm:</p>
            <table class="table1">
                <tr>
                    <td>Mã đấu giá:</td>
                    <td>@Html.DisplayFor(model => model.DauGia.MaDauGia)</td>
                </tr>
                <tr>
                    <td>Tên sản phẩm:</td>
                    <td>@Html.DisplayFor(model => model.DauGia.TenSanPham)</td>
                </tr>
                <tr>
                    <td>Loại sản phẩm: </td>
                    <td>
                        @foreach (var item in Model.ListLoaiSanPham)
                        {
                            @Html.DisplayFor(modelItem => item.TenLoai)
                        }
                    </td>
                </tr>
                <tr>
                    <td>Mô tả sản phẩm:</td>
                    <td>@Html.DisplayFor(model => model.DauGia.MoTa)</td>
                </tr>
                <tr>
                    <td>Vị trí: </td>
                    <td>@Html.DisplayFor(model => model.DauGia.ViTri)</td>
                </tr>
                <tr>
                    <td>Giá khởi điểm: </td>
                    <td>@Html.DisplayFor(model => model.DauGia.GiaBanDau) </td>
                </tr>
                <tr>
                    <td>Mức nâng tối thiểu: </td>
                    <td>@Html.DisplayFor(model => model.DauGia.MucNangToiThieu) </td>
                </tr>
                <tr>
                    <td>Ngày bắt đầu: </td>
                    <td>@Html.DisplayFor(model => model.DauGia.NgayBatDau) </td>
                </tr>
                <tr>
                    <td>Ngày kết thúc: </td>
                    <td>@Html.DisplayFor(model => model.DauGia.NgayKetThuc) </td>
                </tr>
                <tr>
                    <td>Ngày đăng: </td>
                    <td>@Html.DisplayFor(model => model.DauGia.NgayDang) </td>
                </tr>
            </table>

            <p>Thông tin giao dịch: </p>
            <table class="table1">
                <tr>
                    <td>Mã người bán: </td>
                    <td>@Html.DisplayFor(model => model.DauGia.MaNguoiBan) </td>
                </tr>
                <tr>
                    <td>Mã người mua: </td>
                    <td>@Html.DisplayFor(model => model.DauGia.MaNguoiMua) </td>
                </tr>
                <tr>
                    <td>Ngày thanh toán: </td>
                    <td>@Html.DisplayFor(model => model.DauGia.NgayThanhToan) </td>
                </tr>
                <tr>
                    <td>Giá khi thanh toán: </td>
                    <td>@Html.DisplayFor(model => model.DauGia.GiaCuoi) </td>
                </tr>
            </table>
        </div>
        <div class="col-md-6">

            @{
                DauGiaEntities db = new DauGiaEntities();
                var mucnang = db.MucNangs.Where(m => m.MaDauGia == Model.DauGia.MaDauGia).ToList();
                if (mucnang.Count() > 0)
                {
                    TempData["value"] = db.MucNangs.Where(m => m.MaDauGia == Model.DauGia.MaDauGia).Max(m => m.GiaTri);
                }
                else
                {
                    TempData["value"] = Model.DauGia.GiaBanDau;
                }

            }
            <p>Giá hiện tại:</p>
            <table>
                <tr>
                    <th style="font-size:40px; color: orangered">@TempData["value"]</th> @*Ở đây nên để giá đấu giá mỗi khi tăng*@


                </tr>
            </table>
            <p>

                @if (DateTime.Now > Model.DauGia.NgayBatDau)
                {
                    <button id="minus">-</button>
                    <input name="bid" id="bid" disabled="true" value="@TempData["value"]" />
                    <button id="plus">+</button>

                    using (Html.BeginForm("Bid_1", "Home", FormMethod.Post))
                    {
                        <input name="id" hidden="true" value="@Model.DauGia.MaDauGia" />
                        <input id="bid_1" name="bid_1" hidden="true" value="@TempData["value"]" />
                        <input type="submit" value="Ra giá" class="btn btn-default" style="color:black;font-weight:bold;background-color:orangered;font-size:24px" />

                    }
                }
                else
                {
                <p>Đấu giá chưa bắt đầu</p>
            }


                @if (DateTime.Now > Model.DauGia.NgayBatDau && DateTime.Now<Model.DauGia.NgayKetThuc)


                {
                    <p>Thời gian đấu giá còn lại: </p>
                    <p id="demo"></p>

                }
                else if (DateTime.Now > Model.DauGia.NgayKetThuc)
                {
                    <p>Đấu giá kết thúc</p>

                }
                else
                {
                    <p>Đấu giá sẽ bắt đầu trong: </p> <p id="demo_1"></p>

                }
                </p>
            </div>
        <hr />
        <div class="col-md-6" id="cuon">
            <p style="color:red">Danh sách khách hàng đấu giá</p>
            <table class="table1">
                @Html.Partial("_Notifications")
                @{
                    var a = db.MucNangs.Where(m => m.MaDauGia == Model.DauGia.MaDauGia).ToList();
                    foreach (var item in a)
                    {
                        var nd = db.NguoiDungs.Where(m => m.MaNguoiDung == item.MaNguoiDung).SingleOrDefault();
                        <p>@nd.HoTen - @item.GiaTri VNĐ</p>


                    }

                </table>
            </div>
        </div>
        <div class="col-md-12" style="text-align:center">
            <a href='@Url.Action("Home", "Home")' class="btn btn-reload btn-danger ml-3" style="color:black"><i class="fas fa-arrow-alt-circle-left"></i> QUAY LẠI </a>
        </div>
    </div>
    <div class="col-md-12" style="text-align:center">
        <a href='@Url.Action("Home", "Home")' class="btn btn-reload btn-danger ml-3" style="color:black;font-weight:bold"><i class="fas fa-arrow-alt-circle-left"></i> QUAY LẠI </a>
    </div>








    @section scripts {
        <script>
                        $("#plus").click(function () {
                            $("#bid").val(function () {
                                return parseInt(this.value, 10) + @Model.DauGia.MucNangToiThieu;

                            });
                            $("#bid_1").val(function () {
                                return parseInt(this.value, 10) + @Model.DauGia.MucNangToiThieu});
                        });
                        $("#minus").click(function () {
                            $("#bid").val(function () {
                                return parseInt(this.value, 10) - @Model.DauGia.MucNangToiThieu;

                            });
                            $("#bid_1").val(function () {
                                return parseInt(this.value, 10) - @Model.DauGia.MucNangToiThieu});
                        });
            </script>
            @*Từ đây *@
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
            <script>

                @*var day = Model.DauGia.NgayBatDau.Day;
                var month = Model.DauGia.NgayBatDau.Month;
                var year = Model.DauGia.NgayBatDau.Year;
                var hour = Model.DauGia.NgayBatDau.Hour;
                var minute = Model.DauGia.NgayBatDau.Minute;*@


                var day = @Model.DauGia.NgayKetThuc.Day;
                var month = @Model.DauGia.NgayKetThuc.Month;
                var year = @Model.DauGia.NgayKetThuc.Year;
                var hour = @Model.DauGia.NgayKetThuc.Hour;
                var minute = @Model.DauGia.NgayKetThuc.Minute;


            var countDownDate = new Date(month+"/"+day+"/"+year+" "+ hour+":"+minute).getTime();

            // Update the count down every 1 second
            var x = setInterval(function () {

                // Get today's date and time
                var now = new Date().getTime();

                // Find the distance between now and the count down date
                var distance = countDownDate - now;

                // Time calculations for days, hours, minutes and seconds
                var days = Math.floor(distance / (1000 * 60 * 60 * 24));
                var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                var seconds = Math.floor((distance % (1000 * 60)) / 1000);

                // Display the result in the element with id="demo"
                document.getElementById("demo").innerHTML = days + "ngày " + hours + ":"
                    + minutes + ":" + seconds + "s ";

                // If the count down is finished, write some text
                if (distance < 0) {
                    clearInterval(x);
                    document.getElementById("demo").innerHTML = "EXPIRED";
                }
            }, 1000);
            </script>

            <script>

                var day_1 = @Model.DauGia.NgayBatDau.Day;
                var month_1 = @Model.DauGia.NgayBatDau.Month;
                var year_1 = @Model.DauGia.NgayBatDau.Year;
                var hour_1 = @Model.DauGia.NgayBatDau.Hour;
                var minute_1 = @Model.DauGia.NgayBatDau.Minute;


                @*var day = @Model.DauGia.NgayKetThuc.Day;
                var month = @Model.DauGia.NgayKetThuc.Month;
                var year = @Model.DauGia.NgayKetThuc.Year;
                var hour = @Model.DauGia.NgayKetThuc.Hour;
                var minute = @Model.DauGia.NgayKetThuc.Minute;*@


            var countDownDate_1 = new Date(month_1+"/"+day_1+"/"+year_1+" "+ hour_1+":"+minute_1).getTime();

            // Update the count down every 1 second
            var x_1 = setInterval(function () {

                // Get today's date and time
                var now = new Date().getTime();

                // Find the distance between now and the count down date
                var distance_1 = countDownDate_1 - now;

                // Time calculations for days, hours, minutes and seconds
                var days_1 = Math.floor(distance_1 / (1000 * 60 * 60 * 24));
                var hours_1 = Math.floor((distance_1 % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                var minutes_1 = Math.floor((distance_1 % (1000 * 60 * 60)) / (1000 * 60));
                var seconds_1 = Math.floor((distance_1 % (1000 * 60)) / 1000);

                // Display the result in the element with id="demo"
                document.getElementById("demo_1").innerHTML = days_1 + " ngày " + hours_1 + ":"
                    + minutes_1 + ":" + seconds_1 + "s ";

                // If the count down is finished, write some text
                if (distance < 0) {
                    clearInterval(x_1);
                    document.getElementById("demo_1").innerHTML = "EXPIRED";
                }
            }, 1000);
            </script>
            @*Đến đây*@


        }

   
